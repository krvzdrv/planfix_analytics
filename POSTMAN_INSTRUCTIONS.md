# Инструкция по работе с Postman для получения аналитики "x Produkty"

## Шаг 1: Импорт коллекции в Postman

1. Откройте Postman
2. Нажмите "Import" → "File" → выберите файл `Planfix_API_Postman_Collection.json`
3. Коллекция будет импортирована с названием "Planfix API - Analytics"

## Шаг 2: Настройка переменных окружения

1. В коллекции нажмите на вкладку "Variables"
2. Заполните следующие переменные:
   - `PLANFIX_ACCOUNT` - название вашего аккаунта в Planfix
   - `PLANFIX_API_KEY` - ваш API ключ
   - `PLANFIX_TOKEN` - ваш пользовательский токен

## Шаг 3: Поиск аналитики "x Produkty"

### 3.1. Поиск по названию
1. Откройте запрос "Search Actions by Name"
2. В переменной `SEARCH_TEXT` установите значение "Produkty" (или "Продукты")
3. Отправьте запрос
4. В ответе найдите действия, связанные с продуктами

### 3.2. Получение списка всех действий
1. Откройте запрос "Get Actions List"
2. Отправьте запрос
3. Просмотрите список всех действий
4. Найдите действия, связанные с продуктами или аналитикой

## Шаг 4: Получение деталей действия

1. Скопируйте ID найденного действия из предыдущего шага
2. Откройте запрос "Get Action Details"
3. В переменной `ACTION_ID` установите скопированный ID
4. Отправьте запрос
5. В ответе найдите секцию `<analitic>` - это и есть аналитики

## Шаг 5: Анализ структуры аналитики

В ответе на "Get Action Details" вы получите XML с такой структурой:

```xml
<response status="ok">
  <action>
    <id>12345</id>
    <name>Название действия</name>
    <analitic>
      <id>67890</id>
      <name>Название аналитики</name>
      <description>Описание аналитики</description>
    </analitic>
    <!-- Другие аналитики -->
  </action>
</response>
```

## Шаг 6: Получение данных аналитики

1. Скопируйте ID аналитики из предыдущего шага
2. Откройте запрос "Get Analytics Data"
3. В переменной `ANALYTIC_KEY_1` установите ID аналитики
4. Отправьте запрос
5. В ответе вы получите структуру данных аналитики

## Шаг 7: Анализ структуры данных

В ответе на "Get Analytics Data" вы получите XML с такой структурой:

```xml
<response status="ok">
  <analiticDatas>
    <analiticData>
      <key>67890</key>
      <itemData>
        <id>1</id>
        <name>Название поля</name>
        <value>Значение поля</value>
        <valueId>ID значения</valueId>
      </itemData>
      <!-- Другие поля -->
    </analiticData>
  </analiticDatas>
</response>
```

## Примеры поиска

### Поиск по ключевым словам:
- "Produkty"
- "Продукты" 
- "Товары"
- "Аналитика"
- "Отчет"

### Анализ названий действий:
- Действия с названиями, содержащими "продукт", "товар", "аналитика"
- Действия с описаниями, связанными с отчетностью
- Действия, созданные для аналитических целей

## Сохранение результатов

После каждого успешного запроса:
1. Сохраните ответ в Postman
2. Запишите ID найденных аналитик
3. Запишите структуру полей аналитики

## Следующие шаги

После получения структуры аналитики:
1. Создайте таблицу в Supabase на основе структуры
2. Настройте скрипт экспорта данных
3. Запустите автоматический экспорт

## Устранение неполадок

### Ошибка аутентификации:
- Проверьте правильность API ключа и токена
- Убедитесь, что токен не истек

### Пустой ответ:
- Увеличьте `pageSize` в запросах
- Проверьте права доступа к аналитикам

### Ошибка XML:
- Проверьте правильность XML в теле запроса
- Убедитесь, что все переменные заполнены
